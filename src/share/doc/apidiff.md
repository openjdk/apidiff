---
#
# Copyright (c) 2019, 2024, Oracle and/or its affiliates. All rights reserved.
# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
#
# This code is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 2 only, as
# published by the Free Software Foundation.
#
# This code is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# version 2 for more details (a copy is included in the LICENSE file that
# accompanied this code).
#
# You should have received a copy of the GNU General Public License version
# 2 along with this work; if not, write to the Free Software Foundation,
# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
#
# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
# or visit www.oracle.com if you need additional information or have any
# questions.
#

title: 'APIDIFF(1) 1.0 | CodeTools'
date: 2024
lang: en
---

## Name

apidiff - compare different versions of an API

## Synopsis

`apidiff` \[*options*\]

*options*
:   Command-line options

## Description

The `apidiff` command reads source, class and HTML files that provide different versions
of an API, compares corresponding declarations in the different versions and writes out
an HTML report.  The comparison includes:

* structural changes, such as whether an element was added, changed or removed,
  using information in source or class files
* documentation contained in documentation comments,
  using information in source files
* generated API documentation,
  using information found in documentation generated by the `javadoc` tool

## Options

`apidiff` provides different groups of options, to specify
the [APIs](#the-apis) and
the [elements in those APIs](#the-elements-to-be-compared) to be compared,
[output options](#output-options) for the report to be generated, and
[other options](#other-options).

### The APIs

To specify each of the APIs to be compared, use the `--api` _name_ option
followed by a series of options that apply to that API. Most of the options are the
same as the corresponding _javac_ option; see the _javac_ documentation for more details
about those options.

<a id="option-api">`--api` _name_</a>
:   Specifies a name for the API and sets the [current API](#the-current-api) for
    use by the API-specific options that immediately follow this option.
    The option, and the API-specific options that follow, should be provided for each API
    to be compared.
    The order in which the `--api` options first appear on the command line determines
    the order in which any differences are reported.  It is recommended to specify the
    options in chronological order, from the oldest version of the API to the most recent
    version of the API.

<a id="option-api-directory">`--api-directory` *directory*</a>
:   Specifies where to find the generated API documentation for the [current API](#the-current-api).
    If given, it should be the top-level directory of the documentation generated by
    the `javadoc` command for the API.

<a id="option-class-path">`--class-path` *path*, `-classpath` *path*, or `-cp` *path*</a>
:   Specifies where to find files for the class path for the [current API](#the-current-api).

<a id="option-enable-preview">`--enable-preview`</a>
:   Enables preview language features for the [current API](#the-current-api).

<a id="option-jdk-build">`--jdk-build` *directory*</a>
:   Specifies a directory containing a JDK build from which to infer values for
    various options. For example, *repository*`/build/`*configuration-name*

<a id="option-label">`--label` *text*</a>
:   Specifies a short plain-text label for the API, to be included in the generated
    reports. For example, the full version string for the instance of the API being compared.

<a id="option-module-path">`--module-path`</a> *path* or `-p` *path*</a>
:   Specifies where to find application modules for the [current API](#the-current-api).

<a id="option-module-source-path">`--module-source-path` *module-source-path*</a>
:   Specifies where to find source files for the [current API](#the-current-api) when comparing code
    in multiple modules.

<a id="option-patch-module">`--patch-module` *module*`=`*path*</a>
:   Overrides or augments a module in the [current API](#the-current-api) with classes and resources
    in JAR files or directories.

<a id="option-release">`--release` *release*</a>
:   Specifies the release version for the [current API](#the-current-api) for any source and class
    files that may be read.

<a id="option-source">`--source` *release* or `-source` *release*</a>
:   Specifies the source version for the [current API](#the-current-api) for any source files that
    may be read.

<a id="option-source-path">`--source-path` *path* or `-sourcepath` *path*</a>
:   Specifies where to find source files for the [current API](#the-current-api).
    Note that, unlike `javac`, you cannot use this option to specify where to find
    the source code for a single module. Use the `--module-source-path` option instead,
    possibly using the _module-specific form_ of that option.

<a id="option-system">`--system` *jdk* \| `none`</a>
:   Overrides the location of system modules for the [current API](#the-current-api).

By convention, the APIs should be defined on the command in chronological order: oldest first,
newest last. When comparing documentation comments or API descriptions, the APIs will be compared
pairwise, with each of the older instances being compared against the newest instance.

### The Elements to be Compared

<a id="option-access">`--access` `public|protected|package|private`</a>
:   Specifies the access of the declarations to be compared. The default is `protected`.

    * `public`: public declarations only
    * `protected`: public and protected declarations
    * `package`: public, protected and package-private declarations
    * `private`: all declarations

    Note: this option does not apply to the parts of the serialized form
    of a serializable class, even if those parts are provided by private
    methods and fields.

<a id="option-exclude">`--exclude` *pattern*</a>
:   Specifies the patterns for modules or packages to be excluded from the
    comparison.

<a id="option-include">`--include` *pattern*</a>
:   Specifies the patterns for modules or packages to be included from the
    comparison.

<a id="option-compare-api-descriptions">`--compare-api-descriptions` *boolean*</a>
:   Specifies that the API descriptions (as generated by javadoc) should be compared
    for each element being compared.
    The option defaults to `true` if documentation comments are not to be compared
    and if an API directory is given for each instance of the API to be
    compared. (See `--compare-doc-comments`).
    When the option is enabled, either explicitly or by default,
    the API directory must be specified for each instance of the API
    to be compared, and set to the location of the files generated by `javadoc`
    that corresponds to the source and class files being compared.
    The API directory for an API can be specified explicitly, with the `--api-directory`
    option, or indirectly, with the `--jdk-build` and `--jdk-docs` options.

<a id="option-compare-api-descriptions-as-text">`--compare-api-descriptions-as-text` *boolean*</a>
:   Specifies that the HTML for the API descriptions (as generated by javadoc)
    should be compared as plain text for each element being compared. If the argument is `true`,
    this option also implies `--compare-api-descriptions true`.

<a id="option-compare-doc-comments">`--compare-doc-comments` *boolean*</a>
:   Specifies that the documentation comments should be compared for each element
    being compared. This implies that the source files should be available for each
    instance of the API being compared; if they are not available, the documentation
    comments will not be compared.
    The option defaults to `false` if the API descriptions are to be compared,
    and `true` otherwise. (See `--compare-api-descriptions`).

<a id="option-jdk-docs">`--jdk-docs` *name*</a>
:   In conjunction with the `--jdk-build` option, specifies the name of the
    documentation bundle to use when more than one is available.
    For example, `docs`, `javase-docs`, `reference-docs`.

### Output Options

<a id="option-output-directory">`--output-directory` _directory_  or  `-d` _directory_</a>
:   Specifies the directory in which to write the report about the comparison.
    The directory will be created if it does not already exist.

<a id="option-title">`--title` _text_</a>
:   Specifies a title for the report, to be used in each generated page.

<a id="option-description">`--description` _html_</a>
:   Specifies a short description for the report, to be used on the top level summary page.

<a id="option-info-text">`--info-text` _name_`=`_html_</a>
:   Specifies information to be included in different positions on each page.
    _name_ can be one of:

    * `top`: at the top of each page; this may be used to indicate the status
        of the pages.
    * `header`: in the header bar on each page; if not specified, a default value
        is generated, based on the names of the APIs being compared.
    * `footer`: in the footer bar on each page; if not specified, a default value
        is generated, based on the names of the APIs being compared.
    * `bottom`: at the bottom of each page; this may be used to indicate
        copyright and license information,

<a id="option-notes">`--notes` _file_</a>
:   Specifies a file containing [notes] to be added for various elements.

<a id="option-main-stylesheet">`--main-stylesheet` _file_</a>
:   Specifies an alternate stylesheet to use in the generated report
    instead of the system default.

<a id="option-extra-stylesheet">`--extra-stylesheet` _file_</a>
:   Specifies an additional stylesheet to use in the generated report.
    <p class="note">This option may be useful when comparing HTML documentation that
    contains references to custom styles.</p>

<a id="option-resource-files">`--resource-files` _file-or-directory_</a>
:   Specifies resource files to be copied from one or more API directories.
    <p class="note">This option may be useful when comparing HTML documentation that
    depend on some non-HTML resource files.</p>

### Other Options

<a id="option-help">`--help`, `-help`, `-h`, `-?`</a>
:   Displays command-line help.

<a id="option-version">`--version`, `-v`</a>
:   Displays the version of the tool.

<a id="option-verbose">`--verbose` _flag_[`,`_flag_]*</a>
:   Specifies the kinds of verbose output. _flag_ may be one of
    `all`, `none`, or one of the following, optionally preceded by `-`:
    `module`, `package`, `type`, `time`, `options`.

<a id="option-at">`@`*filename*</a>
:   Reads options from a file. To shorten or simplify the `apidiff` command, you can specify
    one or more files that contain arguments for the `apidiff` command. This lets you create
    `apidiff` commands of any length on any operating system.


## The Current API

The current API is the API specified by the most recent `--api` option on the command line,
and is the API for which any API-specific options will apply.

The "current API" is cancelled when any option is given that is not specific to
any one API. Additional options for an API can be given by repeating the `--api`
option to set the API as the current API again.


## Patterns

Patterns provide a way to specify groups of similarly-named modules,
packages and types to be included or excluded from the comparison.

A pattern consists of a _module-part_ and/or a _type_part_.

_module-part_:
:
    | _qualified-identifier_ `/`
    | _qualified-identifier_.*  `/`

_type-part_:
:
    | `**`
    | _qualified-identifier_
    | _qualified-identifier_`.*`
    | _qualified-identifier_`.**`

A _module-part_ that is just a qualified identifier matches the
named module.
A _module-part_ that ends in a wildcard matches all module names that begin
with the given qualified identifier.

A _type-part_ that is just a qualified identifier matches the named type.
A _type-part_ that ends in a single `*` matches all types in the package
with the given qualified identifier.
A _type-part_ that ends in `**` matches all types in all packages that begin
with the given qualified identifier.
A _type-part_ of `**` can only be used in conjunction with a non-empty
module part.

`apidiff` cannot compare a combination of types in named modules and types
in the unnamed module, and so either all patterns must include a module part,
or none must.

## Notes

A "notes" file is used to specify links to be injected into the generated report
for some elements.

The file is a plain text file. Blank lines and lines beginning with `#` are ignored.
The remaining lines are interpreted as a series of blocks, each of which must start
with a line containing a URL and a short plain-text description, followed by
a series of lines, each containing a signature describing an element or set of elements.
For each block, a link based on the URL and description, will be added to any
element appearing in the generated report that matches any of the corresponding
signatures.

The following signatures are supported:

*   _module_
*   _module_ `/*`
*   [ _module_ `/` ] _package_
*   [ _module_ `/` ] _package_ `.*`
*   [ _module_ `/` ] _package_ `.` _type_
*   [ _module_ `/` ] _package_ `.` _type_ `.*`
*   [ _module_ `/` ] _package_ `.` _type_ `#` _field_
*   [ _module_ `/` ] _package_ `.` _type_ `#` `<init>` `(` _parameters_ `)`
*   [ _module_ `/` ] _package_ `.` _type_ `#` _method_ `(` _parameters_ `)`

Signatures should not contain any white-space characters.
Signatures ending in `/*` or `.*` match the specified item, and any enclosed elements down
to the level of a type element.
For methods and constructors, _parameters_ is a comma-separated list of parameter types,
omitting any type parameters, and using just the simple name of any declared types.

For example,

*   `java.base/*` matches the `java.base` module, all packages in `java.base`,
    and all types in those packages.
*   `java.base/java.lang.*` matches the `java.lang` package in the `java.base` module,
    and all types in that package.
    Note that it does not include subpackages, such as `java.lang.reflect`,
    or any types in those subpackages.
*   `java.base/java.lang.String` just matches the type `java.lang.String`.
*   `java.base/java.lang.String#equals(Object)` just matches the `equals(Object)`.

## Configuring the APIs to be compared

At a minimum, the source or class files must be provided for each instance
of the API to be compared.
If the API does not provide or is not part of a module, use the `--source-path`
and `--class-path` options.
If the API provides or is part of one or more modules, use the
`--source-path`, `--module-source-path`, `--module-path`, and related options.

If you want to compare the content of documentation comments, you must provide
source files for all the elements to be compared; any dependencies of those source
files can be specified as either source or class files.

If you want to compare the API descriptions, you must provide the locations
of the directories generated by the `javadoc` tool for each of the instances
of the API being compared. This is often a directory whose path ends in `api`,
although that is not a requirement. To eliminate any false positive differences
being introduced by changes to the `javadoc` tool itself, the same or equivalent
versions of `javadoc` should be used for each API to be compared.

If you want to compare all the exported packages in a module, use
`--include <module>/**`.  If you want to compare the contents of
specific packages in a module, use `--include <module>/<package>.*`
or `--include <module>/<package>.**`. The `.**` form will also include
the contents of any subpackages.  You can use multiple `--include`
options to include different parts of an API in the comparison.

### Configuring instances of JDK to be compared

`apidiff` can be used to compare different instances of JDK, but that can be
tricky to set up, depending on the kind of comparison that is required.
That being said, there is a "convenience" option to specify a JDK build,
as generated by the standard JDK makefiles.

* If you want to compare the files in two separate JDK builds, for each instance
  use the following:

    * the `--api` option to introduce the set of API-specific options that follow
    * the `--jdk-build` option to specify the location of the build containing
      the files to be compared, such as `build/macosx-x64`,
      `build/linux-x86_64-server-release`, or the path for any directory that is
      used for a custom configuration.

  The directory specified with `--jdk-build` should contain the following files:

    * the "marker" file `spec.gmk`,
    * the JDK image, in `images/jdk`,
    * one or more documentation bundles, in `images/*docs*`, if API descriptions
      should be compared, and
    * the source code, in `support/src.zip`, if documentation comments should
      be compared

  In conjunction with this option, use the `jdk-docs` option to specify the name
  of the docs bundle to be compared, when there is more than one. Note this option
  applies to all instances to be compared, and is not specific to the
  [current API](#the-current-api). Use the `--compare-doc-comments` and
  `--compare-api-descriptions` as needed to indicate the comparisons to be included
  in the report.  If neither are specified, `--compare-api-descriptions` is
  the default.

* If you just want to compare some or all of the declarations in different
  instances of JDK, without comparing the documentation comments or API documentation,
  for each instance use the following:

    * the `--api` option to introduce the set of API-specific options that follow
    * the `--system` option to point to the instance of JDK

* If you want to compare the declarations and the corresponding API descriptions
  generated by `javadoc`, for each instance of JDK use the following:

    * the `--api` option to introduce the set of API-specific options that follow
    * the `--system` option to point to the instance of JDK
    * the `--api-directory` option to point to the corresponding documentation
    generated by the `javadoc` tool

* If you want to compare the declarations and the corresponding documentation
  comments, it is recommended to use the following:

    * the `--api` option to introduce the set of API-specific options that follow
    * the `--system` option to point to the instance of JDK
    * a series of `--patch-module` options to specify the location of the
      source for each of the modules to be compared

When using `--patch-module`, you do not need to specify all the source directories
for the module: you just need to specify the source directories containing
the classes whose documentation comments are to be compared.  Any supporting
declarations will be found in the JDK specified by the `--system` option.

If the list of `--patch-module` options is large, it may be convenient to
place them in a file and use the `@`_file_ option to specify the location
of the file. You might also choose to put all the options for an API in
an API-specific `@`_file_.

If you want to compare the API descriptions as well as the documentation comments,
you can combine the recommended options for the two modes, specifying both
`--patch-module` options for the source files and `--api-directory` for the
generated documentation.

If you are using the `--jdk-build` option, and the corresponding `images`
directory has multiple matches for `images/*docs*`, you will need to use
the `--jdk-docs` option to disambiguate which documentation directory to use.
The value that you give should be the name of one of those subdirectories
of the `images` directory. The `--jdk-docs` option is not specific to any
individual API, and need only be given once on the command-line.
It will be used as needed to disambiguate the documentation directory to be
used for any API that is defined by using the `--jdk-build` option.

If you want to see or understand how the options are used internally, you
can use `--verbose options`, possibly implicitly as part of `--verbose all`.

### Comparing different releases of JDK

When comparing any generated API documentation, the comparison is sensitive to any
variations caused by the version of `javadoc` used to generate the documentation.
Therefore, it is highly recommended to use the same version of `javadoc` to generate
all the versions of the documentation to be compared.  When building JDK, although
the standard `docs` and `docs-jdk` targets will use the version of `javadoc` in the
same repository, you can specify the version of JDK to be used for targets like
`docs-reference-api` with the `--with-docs-reference-jdk` option to `configure`,
allowing you to specify the same version of JDK and hence the same version of
`javadoc` to be used to generate the API documentation for each build to be compared.
Generally, the JDK version used to generate the documentation should be at least as
recent as the latest version to be compared.

When comparing recent API changes in JDK, such as when creating a report for a
CSR request, when there is no change in `javadoc` in the versions being compared,
it is reasonable to use the standard `docs` or `docs-jdk` targets to generate the API
documentation to be compared.

### Comparing documentation comments or API descriptions

As well as comparing the declarations found in source files or compiled class files,
`apidiff` can compare documentation comments and/or the API documentation generated
by `javadoc` and the Standard Doclet.

* Comparing documentation comments is easy, and does not require API documentation
  to have been generated. However, it is just a simple text comparison of the text of
  the documentation comments, and so does not take into account any of the analysis
  and processing that is done by the Standard Doclet. Most notably, it does not
  take `{@inheritDoc}` into account, and so might miss some differences in any
  inherited documentation.

* Comparing API descriptions is better for comparing the documentation as generated
  by the Standard Doclet, and as seen by the end user reading the API specification.
  However, it does require that API documentation needs to be generated beforehand,
  and generally using the same version of `javadoc` for all the versions of the API
  that are being compared.

## Operation

The tool operates by creating an instance of the Java compiler front-end
(as found in the [`jdk.compiler`][jdk.compiler] module)
from which it can obtain the selected elements to be compared,
using the [Java Language Model API] and [Compiler Tree API].

_Note: Because the compiler is reading the source and class files for each instance of
the API being compared, the release of the JDK platform used to run `apidiff` must be
at least as recent as each of the releases used to compile the instances to be compared._

When comparing the API descriptions for each selected element, the tool attempts to find
the relevant content in the API documentation that is provided using the
<a href="#option-api-directory">`--api-directory`</a> or
<a href="#option-jdk-build">`--jdk-build`</a> options.
The tool does _not_ attempt to run `javadoc` locally to generate the page on the fly.

[jdk.compiler]: https://docs.oracle.com/en/java/javase/17/docs/api/jdk.compiler/module-summary.html
[Java Language Model API]: https://docs.oracle.com/en/java/javase/17/docs/api/java.compiler/javax/lang/model/package-summary.html
[Compiler Tree API]: https://docs.oracle.com/en/java/javase/17/docs/api/jdk.compiler/com/sun/source/doctree/package-summary.html

## Example

To compare APIs in the `java.base` module in JDK builds `/local/baseline-jdk` and `/local/updated-jdk`, and place the result in the directory `out`, run the following command:

```
bin/apidiff --api jdk \
    --jdk-build=/local/baseline-jdk/build/linux-x86_64-server-fastdebug --jdk-docs docs \
    --api sv \
    --jdk-build=/local/updated-jdk/build/linux-x86_64-server-fastdebug --jdk-docs docs \
    -d out \
    --compare-api-descriptions true \
    --include 'java.base/**'
```

